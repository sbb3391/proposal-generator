{"ast":null,"code":"// import { combineReducers } from 'redux';\nconst defaultState = {\n  requesting: false,\n  clickedAssemblyId: null,\n  machine: {\n    completedMachine: false,\n    assemblies: []\n  },\n  model: {\n    allAssemblies: [],\n    remainingAssemblies: [],\n    remainingPickOneGroupIds: []\n  },\n  proposal: {}\n};\n\nfunction newMachineReducer(state = defaultState, action) {\n  switch (action.type) {\n    case 'RESET_MACHINE':\n      return defaultState;\n\n    case 'ADD_MODEL':\n      return Object.assign({}, { ...state\n      }, {\n        modelId: action.modelId\n      });\n\n    case 'START_FETCHING_ASSEMBLIES':\n      return { ...state,\n        requesting: true\n      };\n\n    case 'ADD_ALL_ASSEMBLIES':\n      // This only gets called once to add all machine assemblies from fetch to the store\n      const requiredAssemblies = action.assemblies.filter(assembly => assembly.required_assembly);\n      const unrequiredAssemblies = action.assemblies.filter(assembly => !assembly.required_assembly); // getting all pickOneGroups and adding it to store\n\n      const allPickOneGroups = action.assemblies.filter(assembly => assembly.pick_one_group);\n      const pickOneGroupIds = allPickOneGroups.map(assembly => assembly.pick_one_group.pick_one_group_id);\n      const uniquePickOneGroupIds = [...new Set(pickOneGroupIds)];\n      return { ...state,\n        machine: {\n          assemblies: requiredAssemblies\n        },\n        model: { ...state.model,\n          allAssemblies: action.assemblies,\n          remainingAssemblies: unrequiredAssemblies,\n          remainingPickOneGroupIds: uniquePickOneGroupIds\n        },\n        requesting: false\n      };\n\n    case 'ADD_ASSEMBLY':\n      // this takes one assembly and adds it to the machine assembly (the one we're building)\n      // and removes it from the list of remaining assemblies that are available for selection\n      const indexOfAddedAssembly = state.model.remainingAssemblies.indexOf(action.assembly);\n      let newState = { ...state,\n        clickedAssemblyId: action.assembly.id,\n        machine: { ...state.machine,\n          assemblies: [...state.machine.assemblies, action.assembly]\n        },\n        model: { ...state.model,\n          remainingAssemblies: [...state.model.remainingAssemblies.slice(0, indexOfAddedAssembly), ...state.model.remainingAssemblies.slice(indexOfAddedAssembly + 1)]\n        }\n      }; // determines if the selected assembly belongs to a 'pick one group.' if it does, all other items in the group will also be\n      // removed as selection options.\n\n      const group = action.assembly.pick_one_group;\n\n      if (group) {\n        const indexOfGroupId = state.model.remainingPickOneGroupIds.indexOf(group.pick_one_group_id);\n        const remainingAssembliesInPickOneGroups = state.model.remainingAssemblies.filter(assembly => assembly.pick_one_group);\n        const assembliesInGroup = remainingAssembliesInPickOneGroups.filter(assembly => assembly.pick_one_group.pick_one_group_id === group.pick_one_group_id);\n        const newRemainingAssemblies = state.model.remainingAssemblies.filter(assembly => !assembliesInGroup.includes(assembly));\n        newState = { ...newState,\n          model: { ...newState.model,\n            remainingPickOneGroupIds: [...state.model.remainingPickOneGroupIds.slice(0, indexOfGroupId), ...state.model.remainingPickOneGroupIds.slice(indexOfGroupId + 1)],\n            remainingAssemblies: newRemainingAssemblies\n          }\n        };\n      }\n\n      return newState;\n\n    case 'REMOVE_CLICKED_ID':\n      return { ...state,\n        clickedAssemblyId: null\n      };\n\n    case 'ADD_MACHINE':\n      return { ...state,\n        machine: {\n          assemblies: action.machine.assemblies\n        }\n      };\n\n    case 'CHANGE_ITEM_PRICE':\n      if (action.item.unitPrice === \"\") {\n        action.item.unitPrice = 0;\n      }\n\n      const assembly = state.machine.assemblies.find(assembly => assembly.id == action.item.assemblyId && assembly.modelId == action.item.modelId);\n      const assemblyIndex = state.machine.assemblies.indexOf(assembly);\n      const item = assembly.items.find(i => i.itemId == action.item.itemId);\n      const itemIndex = assembly.items.indexOf(item);\n      const newAssembly = Object.assign({}, assembly);\n      newAssembly.items[itemIndex].unitPrice = parseFloat(action.item.unitPrice);\n      const assemblyState = state.machine.assemblies;\n      const firstHalf = assemblyState.slice(0, assemblyIndex);\n      const secondHalf = assemblyState.slice(assemblyIndex + 1);\n      return { ...state,\n        machine: { ...state.machine,\n          assemblies: [...firstHalf, newAssembly, ...secondHalf]\n        }\n      };\n\n    case 'ADD_PROPOSAL':\n      debugger;\n\n    default:\n      return { ...state\n      };\n  }\n}\n\nexport default newMachineReducer;","map":{"version":3,"sources":["/home/sbb3391/code/projects/react-proposal-generator/src/reducers/newMachineReducer.js"],"names":["defaultState","requesting","clickedAssemblyId","machine","completedMachine","assemblies","model","allAssemblies","remainingAssemblies","remainingPickOneGroupIds","proposal","newMachineReducer","state","action","type","Object","assign","modelId","requiredAssemblies","filter","assembly","required_assembly","unrequiredAssemblies","allPickOneGroups","pick_one_group","pickOneGroupIds","map","pick_one_group_id","uniquePickOneGroupIds","Set","indexOfAddedAssembly","indexOf","newState","id","slice","group","indexOfGroupId","remainingAssembliesInPickOneGroups","assembliesInGroup","newRemainingAssemblies","includes","item","unitPrice","find","assemblyId","assemblyIndex","items","i","itemId","itemIndex","newAssembly","parseFloat","assemblyState","firstHalf","secondHalf"],"mappings":"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","sourcesContent":["// import { combineReducers } from 'redux';\r\n\r\nconst defaultState = {\r\n  requesting: false,\r\n  clickedAssemblyId: null,\r\n  machine: {\r\n    completedMachine: false,\r\n    assemblies: []\r\n  },\r\n  model: {\r\n    allAssemblies: [],\r\n    remainingAssemblies: [],\r\n    remainingPickOneGroupIds: []\r\n  },\r\n  proposal: {}\r\n}\r\n\r\nfunction newMachineReducer(state = defaultState, action) {\r\n  switch (action.type) {\r\n    case 'RESET_MACHINE':\r\n      return defaultState\r\n    case 'ADD_MODEL':\r\n      return Object.assign({}, {...state}, {modelId: action.modelId})\r\n    case 'START_FETCHING_ASSEMBLIES':\r\n      return {\r\n        ...state,\r\n        requesting: true\r\n      }\r\n    case 'ADD_ALL_ASSEMBLIES':\r\n      // This only gets called once to add all machine assemblies from fetch to the store\r\n      const requiredAssemblies = action.assemblies.filter( assembly => assembly.required_assembly)\r\n      const unrequiredAssemblies = action.assemblies.filter( assembly => !assembly.required_assembly)\r\n\r\n      // getting all pickOneGroups and adding it to store\r\n      const allPickOneGroups = action.assemblies.filter( assembly => assembly.pick_one_group )\r\n      const pickOneGroupIds = allPickOneGroups.map( assembly => assembly.pick_one_group.pick_one_group_id )\r\n      const uniquePickOneGroupIds = [...new Set(pickOneGroupIds)]\r\n\r\n      return {\r\n        ...state,\r\n          machine: {\r\n            assemblies: requiredAssemblies\r\n          },\r\n          model: {\r\n            ...state.model,\r\n              allAssemblies: action.assemblies,\r\n              remainingAssemblies: unrequiredAssemblies,\r\n              remainingPickOneGroupIds: uniquePickOneGroupIds\r\n          },\r\n          requesting: false\r\n      }\r\n    case 'ADD_ASSEMBLY':\r\n      // this takes one assembly and adds it to the machine assembly (the one we're building)\r\n      // and removes it from the list of remaining assemblies that are available for selection\r\n\r\n      const indexOfAddedAssembly = state.model.remainingAssemblies.indexOf(action.assembly)\r\n\r\n      let newState = {\r\n        ...state,\r\n        clickedAssemblyId: action.assembly.id,\r\n        machine: {\r\n          ...state.machine,\r\n          assemblies: [...state.machine.assemblies, action.assembly]\r\n        },\r\n        model: {\r\n          ...state.model,\r\n          remainingAssemblies: [...state.model.remainingAssemblies.slice(0, indexOfAddedAssembly), ...state.model.remainingAssemblies.slice(indexOfAddedAssembly + 1)]\r\n        }\r\n      }\r\n\r\n      // determines if the selected assembly belongs to a 'pick one group.' if it does, all other items in the group will also be\r\n      // removed as selection options.\r\n      const group = action.assembly.pick_one_group\r\n      \r\n      if (group) {\r\n        const indexOfGroupId = state.model.remainingPickOneGroupIds.indexOf(group.pick_one_group_id)\r\n        const remainingAssembliesInPickOneGroups = state.model.remainingAssemblies.filter( assembly => assembly.pick_one_group)\r\n        const assembliesInGroup = remainingAssembliesInPickOneGroups.filter( assembly => assembly.pick_one_group.pick_one_group_id === group.pick_one_group_id )\r\n\r\n        const newRemainingAssemblies = state.model.remainingAssemblies.filter( assembly => !assembliesInGroup.includes(assembly))\r\n\r\n        newState = {\r\n          ...newState,\r\n            model: {\r\n              ...newState.model,\r\n              remainingPickOneGroupIds: [...state.model.remainingPickOneGroupIds.slice(0, indexOfGroupId), ...state.model.remainingPickOneGroupIds.slice( indexOfGroupId + 1) ],\r\n              remainingAssemblies: newRemainingAssemblies\r\n            }\r\n        }\r\n      }\r\n\r\n      return newState;\r\n\r\n    case 'REMOVE_CLICKED_ID':\r\n      return {\r\n        ...state,\r\n          clickedAssemblyId: null\r\n      }\r\n\r\n    case 'ADD_MACHINE':\r\n      return {\r\n        ...state,\r\n        machine: {\r\n          assemblies: action.machine.assemblies\r\n        }\r\n      }\r\n    case 'CHANGE_ITEM_PRICE':\r\n      if (action.item.unitPrice === \"\") {\r\n        action.item.unitPrice = 0\r\n      }\r\n\r\n      const assembly = state.machine.assemblies.find( assembly => assembly.id == action.item.assemblyId && assembly.modelId == action.item.modelId)\r\n      const assemblyIndex = state.machine.assemblies.indexOf(assembly)\r\n      const item = assembly.items.find( i => i.itemId == action.item.itemId)\r\n      const itemIndex = assembly.items.indexOf(item)\r\n\r\n      const newAssembly = Object.assign({}, assembly)\r\n      newAssembly.items[itemIndex].unitPrice = parseFloat(action.item.unitPrice)\r\n      \r\n      const assemblyState = state.machine.assemblies\r\n      const firstHalf = assemblyState.slice(0, assemblyIndex)\r\n      const secondHalf = assemblyState.slice(assemblyIndex + 1)\r\n\r\n      return {\r\n        ...state,\r\n        machine: {\r\n          ...state.machine,\r\n          assemblies: [\r\n            ...firstHalf, newAssembly, ...secondHalf\r\n          ]\r\n        }\r\n      }\r\n    case 'ADD_PROPOSAL':\r\n      debugger;\r\n    default:\r\n      return {...state}\r\n  }\r\n\r\n\r\n}\r\n\r\nexport default newMachineReducer;\r\n"]},"metadata":{},"sourceType":"module"}